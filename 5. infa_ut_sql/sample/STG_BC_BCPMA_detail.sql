--XXX@cht.com.tw
--SDM v20210610
--Date: 2021/06/18

select *

from
(
--Target Records
select *
from MX.STG_BC_BCPMA
where DATA_EXCH_DATE=TO_DATE('2021-06-17','YYYY-MM-DD')

union all
--Source Records
select 
INSKD
,PAYTYP
,PAYKND
,EVIDNO
,EVBRTH
,EVSEX
,EVTDTE
,APCNT
,APDTE
,APNO
,EVNAME
,PBNAME
,NOVMK
,EVCODE
,EVAGE
,UBNO
,EVUBNP
,DEPT
,EVTYPE
,NLWKMK
,PRMK
,PRTYPE
,ADWKMK
,MLDTE
,BFWAGE
,NPWAGE
,NVWAGE
,NPDAYS
,NPAMTS
,WAGE
,PWAGE
,CHKDAY
,CHKAMT
,CHKDTE
,CHKTME
,CHKPNO
,DPCODE
,RCKDTE
,RCKPNO
,RPFORM
,NPYMK
,SAVMK1
,SAVMK2
,SAVMK3
,SAVMK4
,SAVMK5
,POLICYMK
,SIGNLV
,SIGNEX
,SIGNCT
,SIGNED
,EXTF1
,EXTF2
,STS1
,REJECTID
,STS2
,STS3
,EMERG
,VERNO
,GVSUM
,WIDAMT
,NETAMT
,TOTAMT
,RVNAMT
,DELMK
,DELCODE
,CONMK
,CONPNO
,CONDTE
,REJMK
,SPMK
,SPRES
,DRDTE
,PAYDTE
,SPDTE
,RBMK
,SAMCNT
,OTHCNT
,OTSUMTOT
,SUBAMTTOT
,NDOCMK
,RETCD
,CHTYPE
,RPAMT
,RBAMT
,RPCNT
,RPRBMK
,CORRES
,ARFAUDRE
,COMAUDRE
,ADJCD
,SPCH1
,SPCH2
,PVERNO
,BIGPG
,PNTPG
,PNTDTE
,SPUDMK
,EXTDTE
,NRIGHT
,NRECHG
,LSMK
,LOGMK
,RPDTE
,RTCODE
,REPWAY
,HJKIND
,CBMK
,DWCMK
,OFFSETAMT
,TRANSFEE
,CREATOR  
,CREATDTE
,UPPNO
,UPTIME
,EVMINUSAMT
,EVOFFSETAMT
,APEVTYPE
,APUBNO
,NUPTIME
,DIASOURCE
,REJECTID2
,TO_DATE('2021-06-17', 'YYYY-MM-DD') as DATA_EXCH_DATE
from BLIADM.BCPMA@MXlink
) merge_tmp

group by 
--All Columns
INSKD
,PAYTYP
,PAYKND
,EVIDNO
,EVBRTH
,EVSEX
,EVTDTE
,APCNT
,APDTE
,APNO
,EVNAME
,PBNAME
,NOVMK
,EVCODE
,EVAGE
,UBNO
,EVUBNP
,DEPT
,EVTYPE
,NLWKMK
,PRMK
,PRTYPE
,ADWKMK
,MLDTE
,BFWAGE
,NPWAGE
,NVWAGE
,NPDAYS
,NPAMTS
,WAGE
,PWAGE
,CHKDAY
,CHKAMT
,CHKDTE
,CHKTME
,CHKPNO
,DPCODE
,RCKDTE
,RCKPNO
,RPFORM
,NPYMK
,SAVMK1
,SAVMK2
,SAVMK3
,SAVMK4
,SAVMK5
,POLICYMK
,SIGNLV
,SIGNEX
,SIGNCT
,SIGNED
,EXTF1
,EXTF2
,STS1
,REJECTID
,STS2
,STS3
,EMERG
,VERNO
,GVSUM
,WIDAMT
,NETAMT
,TOTAMT
,RVNAMT
,DELMK
,DELCODE
,CONMK
,CONPNO
,CONDTE
,REJMK
,SPMK
,SPRES
,DRDTE
,PAYDTE
,SPDTE
,RBMK
,SAMCNT
,OTHCNT
,OTSUMTOT
,SUBAMTTOT
,NDOCMK
,RETCD
,CHTYPE
,RPAMT
,RBAMT
,RPCNT
,RPRBMK
,CORRES
,ARFAUDRE
,COMAUDRE
,ADJCD
,SPCH1
,SPCH2
,PVERNO
,BIGPG
,PNTPG
,PNTDTE
,SPUDMK
,EXTDTE
,NRIGHT
,NRECHG
,LSMK
,LOGMK
,RPDTE
,RTCODE
,REPWAY
,HJKIND
,CBMK
,DWCMK
,OFFSETAMT
,TRANSFEE
,CREATOR  
,CREATDTE
,UPPNO
,UPTIME
,EVMINUSAMT
,EVOFFSETAMT
,APEVTYPE
,APUBNO
,NUPTIME
,DIASOURCE
,REJECTID2
,DATA_EXCH_DATE

--Normal = 2
having count(*) <> 2
;
